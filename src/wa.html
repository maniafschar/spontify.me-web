<!DOCTYPE html>
<html>

<head>
	<script type="text/javascript">
		var currentChat = document.createElement('chat');
		function init() {
			var xmlhttp = new XMLHttpRequest();
			xmlhttp.onreadystatechange = function () {
				if (xmlhttp.readyState == 4) {
					var start = /^\[\d\d.\d\d.\d\d, \d\d:\d\d:\d\d\] ([^:].*)/;
					var response = xmlhttp.responseText.split('\n');
					var e, s, currentDate, lastChat = '', users = {};
					for (var i = 0; i < response.length; i++) {
						if (response[i].match(start)) {
							if (lastChat) {
								addElement('msg', lastChat);
								document.body.append(currentChat);
								currentChat = document.createElement('chat');
							}
							s = response[i].split(' ');
							if (currentDate != s[0]) {
								currentDate = s[0];
								addElement('date', s[0].replace('[', '').replace(',', ''));
							}
							addElement('time', s[1].replace(']', ''));
							e = addElement('user', response[i].substring(response[i].indexOf(']') + 1, response[i].indexOf(': ')).trim());
							if (users[e.innerHTML])
								users[e.innerHTML].count++;
							else
								users[e.innerHTML] = { count: 1, id: Object.keys(users).length };
							currentChat.classList = 'user' + users[e.innerHTML].id;
							lastChat = response[i].substring(response[i].indexOf(': ') + 2).trim();
						} else
							lastChat += '<br/>' + response[i].trim();
					}
					addElement('chat', lastChat);
					document.body.append(currentChat);
				}
			};
			xmlhttp.open('GET', 'wa/_chat.txt', true);
			xmlhttp.send();
    		}
		function addElement(name, text) {
			var e = document.createElement(name);
			e.innerHTML = text.trim();
			currentChat.appendChild(e);
			return e;
		}
	</script>
	<title>WA</title>
	<style>
		body {
			background: linear-gradient(135deg, #fff, #fffaf7 10%, #fff3ea 20%, #f5f3f0 33%, #ddf3ff 66%, #d0f1c9) 50% fixed;
		}
		chat {
			display: block;
			padding: 1em;
			margin: 0.5em;
		}
		chat.user0 {
			text-align: left;
			background: rgba(0, 140, 255, 0.2);
		}
		chat.user1 {
			text-align: right;
			background: rgba(255, 140, 0, 0.2);
		}
	</style>
</head>

<body onload="init()">
</body>

</html>
